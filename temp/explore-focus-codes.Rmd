---
title: "Group focus and facilitation - res-1-C-V20171226"
subtitle: "_Seeing the world differently_ dissertaton"
author: "Michael Garrett"
institute: East Tennessee State University
thanks: Draft version ;dstmp
date: "`r format(Sys.time(), '08 August, 2017')`"

fontsize: 11pt

output:
  tufte::tufte_handout:
    df_print: kable
    fig_caption: yes
    fig_height: 4
    includes:
      in_header:
      - ~/Documents/sup/latex/includes/use_sansmath.tex
      - ~/Documents/sup/latex/includes/diss_std.tex
    keep_tex: no
  tufte::tufte_book:
    citation_package: natbib
  tufte::tufte_html: default
---

```{r setup, message = FALSE, warning = FALSE, echo = FALSE}

## Environment assumes these packages have been installed --------------

# Dataset manipulation
library(tidyverse)
library(lubridate)  # not being installed by tidyverse

# Formating output
library(tufte)      # newthought, marginfigure
library(knitr)      # for kable()
library(kableExtra)
library(xtable)     # making latex code for margin tables
library(pander)

## External source files ----------------

## Knitr options

opts_chunk$set(comment = NA)  # do not prepend results with a marker
opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)  # do not display R in doc
opts_chunk$set(fig.path = "images/")  # dump a copy of the figures here

# From tufte .Rmd example file. Not sure of purpose
# opts_chunk$set(tidy = FALSE, cache.extra = packageVersion('tufte'))
#   options(htmltools.dir.version = FALSE)

```

```{r params, message = FALSE, warning = FALSE, echo = FALSE}


```

**Problem statement**

>   **1**. Check the integrety of the group focus dataset
>
>   **2**. Explore the group focus dataset for meaningful patterns
>
>   Group focus dataset:
>
>   `r dsname$fname` -- **Coder "mdg", "slg"**

# Introduction

The _Seeing the world differently_ workshop comprised 3 phases: the "research phase", "conference phase", and "publication phase". The data explored here is from the research phase. 

In the research phase, participants formed small work-groups and were tasked by a facilitator to work with a target phenomenon for about 20 minutes, with directions to "describe what you see and explain why it happens" using pencil and semi-structured forms called "flipbooks". When time was called, all groups moved to a new round of work using a different phenomenon. This effort by a group to "describe and explain" a simple phenomenon is one of the basic academic tasks being studied.

```{r session-info}

## Present overview of all sessions

# Build a tbl describing sessions
tmp <-   read_session_tbl() %>% 
    left_join(read_group_tbl(), by = "gid") %>%
    mutate(Length = Duration/60) %>% 
    select(round, `Group` = gid, Phenomenon, Mins = Length)
# Convert it to an xtable object
tmp <- xtable(tmp, digits = 0)
# Capture it in a latex tabular environment to be put into the margin below
tmp <- print(tmp,
        comment = F, print.results = F, floating = F, 
        include.rownames = F, caption.placement = "top")
# Add a caption
tmp <- paste("The six research phase sessions\\vskip 11pt", tmp)

```

`r margin_note(tmp)` Workshop participants formed three groups, identified in the study databases as "A", "B", and "C". There were three physical phenomena to explore: a stuffed toy being swung on a string ("Bear"), a half-filled bottle of ketchup ("Ketchup"), and a marble in a box ("Ball"). The groups went through two rounds together, giving six task engagments, or "sessions". Since there were two work rounds, each group worked with two different phenomenon.

## Method for Coding Facilitation and Focus

Group work was coded in two rounds, or "tiers": first for whether a group was engaged with the facilitator during work ("facilitation coding"), and second for the focus of the group as it worked ("focus coding"). 

**Tier 1:** _Facilitation coding_ uses two codes: `Independent` or `Facilitated`. During facilitated work, the group worked with the facilitator, while in independent work, it did not.`r margin_note("Exclusive: i.e, facilitation code intervals can't overlap.")` The facilitation coding scheme is _exhaustive_, meaning that no point in a session isn't in a coded interval, and is  _exclusive_, meaning no point can have two work codes.

**Tier 2:** _Focus coding_ had six codes: Reading, Doing, Representing, Discussing, Other on-task work, or Off-task work. `r margin_note("Not exclusive: i.e., focus code intervals can overlap")` These codes are explained below. The focus coding scheme is exhaustive but not exclusive.

`r newthought('Facilitation and focus were coded by the investigator')` from video. During the workshop, each group's activities were videorecorded by an assistant dedicated to that group. For each session, the recording was trimmed to the beginning and end of session work and standardized to a display resolution of 960x540 pixels (qHD) at 25 frames per second (fps). These trimmed videos were viewed using Adobe's Premiere Pro, which allowed forward and backward, slow- and high-speed, and frame-by-frame viewing. A code was applied with Premiere Pro over a "code interval" by marking the beginning (In) and end (Out) points for text that overlaid the code on the image (Figure 1). 

```{r video-frame, echo=FALSE, fig.cap = "Example frame of a coded video showing overlaid information. Coding information appears as title text overlaying the videorecording of the session. \\newline The timecode (lower right) gives minutes and seconds from the beginning of the trimmed recording. The last two digits give the number of video frames passed since the last tick of the seconds timer. All coding videos are encoded at 25 frames per second. This allows synching with other coding software to within 40 ms."}
include_graphics(file.path(pars$image_folder, "res-2-A-coding-eg1-med.png"), dpi = 150)
```

If work was facilitated, a white marker appears in the upper left of a coded video. Focus codes display in the upper right corner. Focus codes `r margin_note("Because a group's focus can be split, there may be one or two focus codes displayed. Whether a code is first or second depends on the way codes were applied and carries no meaning.")` during independent work display in orange and those applied during faciliated display in green. The round, group, and phenomenon being explored display in the bottom left along with the study participant IDs. A running "timecode" marking the position of the video from the beginning of the session displays in the lower right.

`r newthought("Focus codes were defined")` by the investigator initially to capture whether a group was working on their representations or with materials. After several coding passess, it was clear that groups focused on other things as well, for example, working to understand if they were "doing it right" or getting materials for their representations. 

The focus code set was finalized, after repeated coding passes, on the seven codes defined below:

```{r focus-code-table}

pander(fc_tbl, justify = c("left", "left", "left"), 
       split.tables = 100, split.cells = c(2, 13, 70))

```

# The Focus Code Dataset

The observational unit in the dataset is a "codestamp", seven variables describing a single code interval. A codestamp comprises: two variables (`code`, `type`) giving the code and it's type, two variables (`In`, `Out`) giving beginning and end timestamps of the code interval relative to the start of the video, two (`round`, `gid`) identifying the round and group that was coded, and one (`bin`) identifying the facilitation level at the time. 

The overlaid code texts and the In / Out markers for each coded video were exported from the Premiere Pro project files to editable text files. These were manipulated using the _R_ statistical language (a) to recode the complex video timecodes into numeric "timestamps", and (b) to add context information to each coded interval. This augmented data was then saved as _R_ dataframe tables. The tables for each session were then combined into a single dataset. This final focus codeset contains 205 codestamps covering all groups for both rounds.

Table 1 shows a random sample of codestamps from the dataset ` `r dsname$fname` `.

```{r get-data}

tmp <- res2A_focus_hand_cstamp
fd1 <- tmp[[1]]$data
fd2 <- tmp[[2]]$data
fd <- bind_rows(fd1, fd2)
focus_code_df <- fd

kable(sample_n(focus_code_df, 15), 
  caption = paste("Random sample of code data from dataset", "res2A"))

```

The `In` and `Out` variables show the timestamps for a code interval. The timestamp have the date of the workshop prepended to the session time to facilitate analysis with _R_, but only the time (HH:MM:SS) portion is interpretable. These are the orginal offsets from the beginning of a video recording of the session. Since sessions likely began at differing times, these In/Out timestamps cannot be used to align work _between_ sessions.

`r newthought("Timecodes, timestamps, and codestamps")` are not the same thing.`r margin_note("For example, in Figure 1, the timecode displays 00:09:47:05, representing 9 min, 47 sec, and 5 frames. At 25 fps, the elapsed frames are equivalent to 0.2 seconds, and the elapsed time at that frame is 9 min, 47.2 sec. This would be rounded to produce the timestamp 00:09:47.")` Due to the nature of videorecording, the _timecodes_ overlayed on the recording count time to the second, and then append the number of video frames since that second. The _timestamps_ computed by _R_ convert the frame count into an elapsed fraction of a second and adds that to the time. _Codestamps_ are the observational unit of the dataset, and inlcude the code and the timestamps plus the other contextual information.

# Exploration of the dataset

The purpose of this exploration is to evaluate the integrety of the focus code dataset and to look for meaningful patterns in the data `r margin_note("Missing values. Early coding runs gave several missing values in the codestamps. Tracking these down showed some inconsistencies in the coding and resulted in a revision of the coding schemes. After several more rounds, the schemes were applied consistenly and the dataset contained no missing values.")`


## Consitency and patterns in the number and types of codes 

The seven codestamp variables in the dataset are summarized in Table 2. For the catgorical variables, `round`, `gid` (group ID), `bin`, `type`, and `code`, the table gives tallies of how many codes are found at the different levels of the variable. For example, there are 79 codes at level 1 of the variable `round`. For the time variables, `In` and `Out`, the table describes how codes' beginnng and end times are distributed. For example, the lowest beginning time for a code was at the beginning of a session, and the latest ending time was at 17 min, 1 sec

```{r variable-summaries}

options(knitr.kable.NA = '')
# Summarize data
kable(summary(focus_code_df),
  caption = paste("Summary of the variables in dataset", "res2A"))

```

All of the codes focus types as they should be since this is a database of "focus" codes only. Of the 205 code intervals, 79 are in round 1 and 126 in round 2, implying that the focus of work in the second round was overall more fragmented. Group B had the largest number of codes, meaning that they changed focus most often overall. There are 131 focus codes under independent work and 74 under facilitated work, which should happen if the groups had more indpendent time than facilitated time, and could also suggest facilitated work changed focus less often. The distribution of `code` levels shows there was very little off-task work and that most of the work was focused on doing, followed by representing, and then working on instructions.

The distributions of the timestamps seem reasonable. In markers begin at the start of a session and end before the end of the longest session, as they should. Out markers begin after the first In marker and end at the length of the longest session, as they should. Means are slighly higher than medians, indicating each distribution has a modest right skew.

`r newthought("Counts of codes for various groupings")` are summarized in Table 3. The first three columns show how many focus codes were assigned to each group for each round. The second three shows how many of each type of code was assigned during the two rounds. The final three show how many codes were assigned to each group over the two rounds.

```{r code-tallies, fig.fullwidth = TRUE}

# Tallies of total codings by session (round x gid)
l1_tmp <- focus_code_df %>%
  group_by(round, gid) %>%
  summarize(RxG = n())

# Tallies of codes by round (round x code)
l2_tmp <- focus_code_df %>%
  group_by(round, code) %>%
  summarize(RxC = n())

# Tallies of codes by round (gid x code)
l3_tmp <- focus_code_df %>%
  group_by(gid, code) %>%
  summarize(GxC = n())

# Pad dfs with NA. Will make use of this in kable
nr_tmp <- max(nrow(l1_tmp), nrow(l2_tmp), nrow(l3_tmp))
if (nrow(l1_tmp) < nr_tmp) {l1_tmp[(nrow(l1_tmp)+1):nr_tmp, ] <- NA}
if (nrow(l2_tmp) < nr_tmp) {l2_tmp[(nrow(l2_tmp)+1):nr_tmp, ] <- NA}
if (nrow(l3_tmp) < nr_tmp) {l3_tmp[(nrow(l3_tmp)+1):nr_tmp, ] <- NA}

# Print combined dfs in a table wo NAs
options(knitr.kable.NA = '')
kable(bind_cols(l1_tmp, l2_tmp, l3_tmp),
      col.names = c("Round", "Group", "N", "Round", "Code", "N", "Group", "Code", "N"),
      caption = paste("Count of codes in dataset", "res2A"))

rm(l1_tmp, l2_tmp, l3_tmp, nr_tmp)  # not needed anymore

```

`r newthought("The distributions of In and Out timestamps over time")` are summarized in Figure 2. Since, for all code intervals, In markers should come before Out markers, the data should show more In than out early in the session and more Out than In later, and roughly the same in between. This is borne out by the data. 

```{r focus-inout-histogram, fig.margin = TRUE, fig.height = 3, fig.cap = "Distribution of In and Out timestamps by round and Group. There are more In codes than Out codes at the beginning, and vice versa at the end."}

# Stack cstamps so codes can be grouped by whether they mark In or Out
gather(focus_code_df, key = In_Out, value = Time, In, Out) %>% 
  # Plot distribution of times by group and stacked by In/Out
  ggplot(aes(x = Time, col = In_Out)) + 
    geom_histogram(bins = 5) + 
    labs(list(title = "In/Out timestamps for all sessions",
              caption = "res2A"))

```

## Consistency and patterns in the lengths of code intervals

Plots of In timestaps vs. Out timestamps for each round displayed in Figure 3. These plots allow a quick inspection for impossible code intervals and for outlying data that need verification. In each graph, a line shows where In and Out timestamps would be equal. Any data on this line would have zero length code intervals and data below this line would have negative lengths, both impossible. The further above this line a point is, the longer is the interval. 

```{r focus-out-v-in, fig.fullwidth = FALSE, fig.cap = "Looking for unlikely code intervals. Higher points are for longer code intervals. Points close to the line are for short intervals. Points below the line would have Out < In"}

# Out vs. In stamps by Code and round
ggplot(focus_code_df) +
  geom_point(aes(x = In, y = Out, col = code)) +
  geom_abline(slope = 1, intercept = 0, col = "grey") +
  scale_color_manual(values = pars$code_col) +
  labs(list(title = "Out times vs. In times, paneled by Coder",
            caption = "res2A")) +
   facet_wrap(~ coder)

```

No code intervals have zero or negative lengths. Most code intervals are fairly close to the line, i.e., are short duration, consistent with work focus, which might be expected to change frequently. There are two outlying Rp code intervals, at about 9 - 12 min and 11 - 15 min, and one outlying Do interval at about 1 - 4 min that merit investigation.

\newpage

## Consistency and patterns in the distribution of code intervals throughout the sessions

The next three figures map the focus codes over session time. Codes are organized on the y-axis in a reasonable expectation of how group work would progress: first reading instructions, then working with the materials, then working to represent thinking, and then talking about how the work is going. Intervals are color-coded by facilitation level to show at a glance when work was independent or facilitated. 

These displays highlight codestamps that are out of place or suspiciously long. They also suggest patterns of group and facilitator behavior. Scanning across a line shows over what times a code applies and when work changes in facilitation. Scanning across lines show whether focus was split between two codes. 

```{r focus-segplot-1-setup, warnings = FALSE}

## This begins a series of "segment plots" showing codestamps over the
# length of a session. Each plot is saved as an object to f12litate future 
# alterations.

# Apply these whenever a new base segplot is made
pl_labels <- list(y = "Focus code", color = "type", caption = "res2A")

focus_segplot <- wkf_pl_cstamps(focus_code_df, pl_labs = pl_labels)

```

`r newthought("The first graph overlays intervals")` for all groups and for both rounds on the sime timeline. Because intervals are overlaid, the brighter segments show where several groups are focused the same at about the same time in their sessions.

```{r focus-segplot-1a, warning=FALSE, fig.cap = "Occurance of codes over all sessions. Colors must overlap, since when the facilitator works with one group, the others are working independently. There is very little off-task work. Most time is focused on representing and doing, while considerable facilitated work is spent on discussing instructions."}

#  Plot 1: codestamps by time. All sessions overlaid
focus_segplot_1a <- focus_segplot +
  labs(list(subtitle = "If more than one coder, they are overlaid"))
focus_segplot_1a + theme_bw()
```

The graph shows that by far most of the work focused on doing and representing. A scan down the Of and O codes show groups spent very little time off-task and little time in busywork, and that mostly towards the end of their sessions. The first minute or two was largely spent working with the instructions without attempting to represent a phenomenon before working with it. After that, most work on instructions was done during facilitated work.

`r newthought('The second graph overlays groups but separates codes by round,')` allowing a comparison of work between rounds. 

```{r focus-segplot-1b, warning=FALSE, fig.cap = "Occurance of codes separated by round. Both show a simular structure, with sessions starting by working on instructions, then moving to doing, and then moving between representing, doing, and occasionally revisiting instructions, largely during facilitation. However, work during round 2 is more fragmented among different focuses."}

#  Plot 2: Put each round in a separate panel
focus_segplot_1b <- focus_segplot_1a +
  labs(list(subtitle = "Panels indicate the two different coders")) +
  facet_wrap(~ coder, ncol = 1)

focus_segplot_1b + theme_bw() + theme(strip.text = element_text(size = 6))

```

Round two was longer by about 2 minutes. The pattern Rd, Do, Rp holds for round two but not round one, where there was a significant focus on doing along with work on instructions, but the focus of work is visibly much more fragmented in round two. Doing and representing are the major focuses in both rounds, but doing is more spoty in round two. In each, revisiting instructions is largely facilitated, but not as much so in round two. At this level, there are still no anomolous intervals or reasons to worry about data integrity.

`r newthought('The third graph separates all sessions')` allowing each group's work to be examined separately and the groups to be compared. A group working with a split focus shows as one interval above another and a jump in focus shows as gaps in a code line. A group's movement between working on instructions, working with materials, and working to represent thinking is apparent. Patterns of facilitation are shown by the appearance of purple segments in the code lines. These graphs clearly show the large-scale structure of each group's work on their academic tasks.


```{r focus-segplot-1c, fig.width = 6.5, fig.height = 6, fig.fullwidth = TRUE, warning=FALSE, fig.cap = "Occurance of codes separated by session (round X group). The facilitator is engaged with each group, usually briefly, withing the first few minutes, always while groups are focused on the instructions."}

focus_segplot_1c <- focus_segplot_1a + 
  # Use geom_text to print phenomenon on each graph when faceted by Round and gid
  geom_text(data = read_session_tbl(),
    # Place text left of t0 and on the "Of" code line
    aes(x = ymd_hms(pars$t_workshop), hjust = "left",
        y = factor("Of", levels = pars$focus_codes), 
        label = Phenomenon), 
    inherit.aes = FALSE, 
    nudge_x = 50, nudge_y = -0.5) +
  labs(list(subtitle = 
    "Panels indicate the round and group. \nThe phenomenon explored is printed on each graph.")) +
  facet_wrap(~ gid * round, ncol = 2)

focus_segplot_1c + theme_bw() + theme(strip.text = element_text(size = 6))

```
At this level, the outlying Rp intervals are seen in sessions 2-B and 1-C, and the outlying Do interval is in 1-C as well. The first code interval in session 1-B is Do, followed quickly by Rd, not impossible but worth verifying. No other intervals look suspicious. The negligable off-task work is scattered between group B in round 2 and group C in both rounds. 

After the first minute, all work revisiting instruction was intermittent and very brief and, except for group A in round two, almost exclusivley during facilitation, suggesting this as a major role of the facilitator. The increased fragmentation of work focus in round two is most notable in groups A and C, but especially in group A who had an unsually small average focus intervals. The apparent pattern of Rd, Do, Rp is not maintained consistent among the sessions. In some sessions work is split between the two simultaneously (1-B, 1-C), while in others the focus shifts from one to the other (1-A, 2-A, 2-B), and in one the pattern is mixed (1-C).

Overall, groups worked much more independantly than with facilitation. Most facilitated work lasts a minute or less, and on average lasts shorter than most independent work. In all sessions, the facilitator interacted briefly with the group within the first two minutes, largely around instructions. Facilitated work focused on instructions reoccured intermittantly for all sessions, and in relatively brief intervals. Facilitated work otherwise is mostly in longer intervals and split between a focus on doing and representing.

## Consistency and patterns in facilitation

Figure 7 shows group focus only during facilitation. This display gives both an indication of how the facilitator spent his time and how groups behaved under facilitation. However, these codes do not show the intentions of the facilitator directly. Focus coding looks at the focus of the entire group, which during facilitation is made of the participants plus the facilitator. 

```{r focus-segplot-2, fig.width = 6.5, fig.height = 6, fig.fullwidth = TRUE, warning=FALSE, fig.cap = "Group focus during facilitation overlaid for all groups and both rounds."}

# Begin with new call to segplot function. (*Couldn't get %in% to work*)
focus_segplot_2a <- filter(focus_code_df, bin == "Fac")  %>% 
  pl_focus_segment_plot(pl_labs <- pl_labels) + 
  labs(list(title = "Work focus during facilitated work",
            subtitle = "Rounds and groups are overlaid"))

focus_segplot_2a + theme_bw()

```

Facilitation work seems evenly divided among working on instructions, workinging with materials, and working on representations. `r margin_note("Earlier graphs showed that most work on instruction after the first minutes were with facilitation, but this graph reveals that the converse is not true: most facilitation is not taken up working on instructions. ")` Facilitated revisiting of instructions for the tasks is scattered evenly across session time. Facilitated doing begins about 4 minutes into the sessions along with work on representation of thinking. Facilitation continues working on representation alone with regular revisiting of instructions until the last third of session time. At about twelve minutes into the sessions, the focus of faciliated work is almost exclusively on doing, that is, revisiting materials. Any work being done on representation during the final third was independent.
