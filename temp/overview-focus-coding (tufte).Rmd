---
title: "Overview of focus and facilitation coding"
subtitle: "_Seeing the world differently_ dissertaton"
author: "Michael Garrett"
institute: East Tennessee State University
thanks: Draft version 20171227
date: "`r format(Sys.time(), '27 December, 2017')`"

fontsize: 11pt

output:
  tufte::tufte_handout:
    df_print: kable
    fig_caption: yes
    fig_height: 4
    includes:
      in_header:
      - ~/Documents/sup/latex/includes/use_sansmath.tex
      - ~/Documents/sup/latex/includes/diss_std.tex
    keep_tex: no
  tufte::tufte_book:
    citation_package: natbib
  tufte::tufte_html: default
---

```{r packages, message = FALSE, warning = FALSE, echo = FALSE}

## Environment assumes these packages have been installed --------------

# Dataset manipulation
library(tidyverse)
library(lubridate)  # not being installed by tidyverse

# Formating output
library(tufte)      # newthought, marginfigure
library(knitr)      # for kable()
library(kableExtra)
library(xtable)     # making latex code for margin tables
library(pander)

```

```{r knitr_setup}

## Knitr options
#
#  Some (all?) Knitr options will not apply to the current chunk, (E.g., "root.dir".  
#  cf. https://github.com/yihui/knitr/issues/277), so I will get into the habit of putting Knitr 
#  options into a lead chunk if I can.

opts_knit$set(root.dir=normalizePath('../'))  # assumes .Rmd files are one level below proj

```

```{r proj_setup}
## Project-wide parameter list

opts_knit$get("root.dir")
setwd(opts_knit$get("root.dir"))
source("config.R")
print(paste("in proj setup chunk..."))
print(paste("... knitr rd:", opts_knit$get("root.dir")))
pars <- read_config()

## External source files ----------------

source(file.path(pars$utils, "base-utils.R"))  # read_ functions
source(file.path(pars$utils, "plot-utils.R"))  # segment plots 

## Knitr options

opts_chunk$set(comment = NA)  # do not prepend chunk results with a marker
opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)  # do not display R in doc
opts_chunk$set(fig.path = "images/")  # dump a copy of the figures here

# From tufte .Rmd example file. Not sure of purpose
# opts_chunk$set(tidy = FALSE, cache.extra = packageVersion('tufte'))
#   options(htmltools.dir.version = FALSE)

```

```{r params, message = FALSE, warning = FALSE, echo = FALSE}


# Local

#  Dataset specifiers - This determines which dataset will be read
#
#  Specifies: handcode-cstamp-res-1-C-focus-V20171226

dsname <- list()
dsname$fname   <- ""
dsname$Method  <- "handcode"
dsname$Stamp   <- "cstamp"
dsname$Phase   <- "res"
dsname$Round   <- "1"  # ds with coding for all rounds combined
dsname$GID     <- "C"  # ds with coding for all groups
dsname$Type    <- "focus"  # only focus codes
dsname$Version <- "V20171226"

dsname <- build_dsname(dsname)

#  Coder IDs - This determines which coder's codestamps will be used 

localPars$coder = c("mdg", "slg")

```

**Problem statement**

>   **1**. Check the integrety of the group focus dataset
>
>   **2**. Explore the group focus dataset for meaningful patterns
>
>   Group focus dataset:
>
>   `r dsname$fname` -- **Codes from: ** `r localPars$coders`

# Introduction

The _Seeing the world differently_ workshop comprised 3 phases: the "research phase", "conference phase", and "publication phase". The data explored here is from the research phase. 

In the research phase, participants formed small work-groups and were tasked by a facilitator to work with a target phenomenon for about 20 minutes, with directions to "describe what you see and explain why it happens" using pencil and semi-structured forms called "flipbooks". When time was called, all groups moved to a new round of work using a different phenomenon. This effort by a group to "describe and explain" a simple phenomenon is one of the basic academic tasks being studied.

```{r descriptions-of-sessions}

## Present overview of all sessions
#  
#  Session info should be kept in session tables in project storage
#  There is a setup script to create these from excel datasheets

# Get tbl describing sessions
tmp <-   read_session_tbl() %>% 
    left_join(read_group_tbl(), by = "GID") %>%
    mutate(Length = Duration/60) %>% 
    select(Round, `Group` = GID, Phenomenon, Mins = Length)
# Convert it to an xtable object
tmp <- xtable(tmp, digits = 0)
# Capture it in a latex tabular environment to be put into the margin in the report text below
tmp <- print(tmp,
        comment = F, print.results = F, floating = F, 
        include.rownames = F, caption.placement = "top")
# Add a caption
tmp <- paste("The six research phase sessions\\vskip 11pt", tmp)

```

`r margin_note(tmp)` Workshop participants formed three groups, identified in the study databases as "A", "B", and "C". There were three physical phenomena to explore: a stuffed toy being swung on a string ("Bear"), a half-filled bottle of ketchup ("Ketchup"), and a marble in a box ("Ball"). The groups went through two rounds together, giving six task engagments, or "sessions". Since there were two work rounds, each group worked with two different phenomenon.

# Method for Coding Facilitation and Focus

Group work was coded in two rounds, or "tiers": first for whether a group was engaged with the facilitator during work ("facilitation coding"), and second for the focus of the group as it worked ("focus coding"). 

**Tier 1:** _Facilitation coding_ uses two codes: `Independent` or `Facilitated`. During facilitated work, the group worked with the facilitator, while in independent work, it did not.`r margin_note("Exclusive: i.e, facilitation code intervals can't overlap.")` The facilitation coding scheme is _exhaustive_, meaning that no point in a session isn't in a coded interval, and is  _exclusive_, meaning no point can have two work codes.

**Tier 2:** _Focus coding_ had six codes: Reading, Doing, Representing, Discussing, Other on-task work, or Off-task work. `r margin_note("Not exclusive: i.e., focus code intervals can overlap")` These codes are explained below. The focus coding scheme is exhaustive but not exclusive.

`r newthought('Facilitation and focus were coded by the investigator')` from video. During the workshop, each group's activities were videorecorded by an assistant dedicated to that group. For each session, the recording was trimmed to the beginning and end of session work and standardized to a display resolution of 960x540 pixels (qHD) at 25 frames per second (fps). These trimmed videos were viewed using Adobe's Premiere Pro, which allowed forward and backward, slow- and high-speed, and frame-by-frame viewing. A code was applied with Premiere Pro over a "code interval" by marking the beginning (In) and end (Out) points for text that overlaid the code on the image (Figure 1). 

```{r video-frame, echo=FALSE, fig.cap = "Example frame of a coded video showing overlaid information. Coding information appears as title text overlaying the videorecording of the session. \\newline The timecode (lower right) gives minutes and seconds from the beginning of the trimmed recording. The last two digits give the number of video frames passed since the last tick of the seconds timer. All coding videos are encoded at 25 frames per second. This allows synching with other coding software to within 40 ms."}

include_graphics(file.path(pars$image_folder, "res-2-A-coding-eg1-med.png"), dpi = 150)

```

If work was facilitated, a white marker appears in the upper left of a coded video. Focus codes display in the upper right corner. Focus codes `r margin_note("Because a group's focus can be split, there may be one or two focus codes displayed. Whether a code is first or second depends on the way codes were applied and carries no meaning.")` during independent work display in orange and those applied during faciliated display in green. The round, group, and phenomenon being explored display in the bottom left along with the study participant IDs. A running "timecode" marking the position of the video from the beginning of the session displays in the lower right.

`r newthought("Focus codes were defined")` by the investigator initially to capture whether a group was working on their representations or with materials. After several coding passess, it was clear that groups focused on other things as well, for example, working to understand if they were "doing it right" or getting materials for their representations. 

The focus code set was finalized, after repeated coding passes, on the seven codes defined below:

```{r focus-code-table}

# A printable copy of the coding scheme should be available in project storage
#  There is a setup script to create this table. Need pander to create stable LaTex for this table

fc_tbl <- as_data_frame(
  readRDS(file.path(pars$data_folder, "study", "focus-code-tbl.rds")))

pander(fc_tbl, justify = c("left", "left", "left"), 
       split.tables = 100, split.cells = c(2, 13, 70))

```

# Example Focus Code Dataset

The observational unit in the dataset is a "codestamp", seven variables describing a single code interval. A codestamp comprises: two variables (`Code`, `Type`) giving the code and it's type, two variables (`In`, `Out`) giving beginning and end timestamps of the code interval relative to the start of the video, two (`Round`, `GID`) identifying the round and group that was coded, and one (`Bin`) identifying the facilitation level at the time. 

The overlaid code texts and the In / Out markers for each coded video were exported from the Premiere Pro project files to editable text files. These were manipulated using the _R_ statistical language (a) to recode the complex video timecodes into numeric "timestamps", and (b) to add context information to each coded interval. This augmented data was then saved as _R_ dataframe tables. The tables for each session were then combined into a single dataset. This final focus codeset contains 205 codestamps covering all groups for both rounds.

Table 1 shows a random sample of codestamps from the dataset ` `r dsname$fname` `.

```{r get-data}

focus_code_df <- read_dataset(dsname) %>% 
  filter(Coder %in% localPars$coder)
# Display 5 rows for inspection
kable(sample_n(focus_code_df, 10), 
  caption = paste("Random sample of code data from dataset", dsname$fname))

```

The `In` and `Out` variables show the timestamps for a code interval. The timestamp have the date of the workshop prepended to the session time to facilitate analysis with _R_, but only the time (HH:MM:SS) portion is interpretable. These are the orginal offsets from the beginning of a video recording of the session. Since sessions likely began at differing times, these In/Out timestamps cannot be used to align work _between_ sessions.

`r newthought("Timecodes, timestamps, and codestamps")` are not the same thing.`r margin_note("For example, in Figure 1, the timecode displays 00:09:47:05, representing 9 min, 47 sec, and 5 frames. At 25 fps, the elapsed frames are equivalent to 0.2 seconds, and the elapsed time at that frame is 9 min, 47.2 sec. This would be rounded to produce the timestamp 00:09:47.")` Due to the nature of videorecording, the _timecodes_ overlayed on the recording count time to the second, and then append the number of video frames since that second. The _timestamps_ computed by _R_ convert the frame count into an elapsed fraction of a second and adds that to the time. _Codestamps_ are the observational unit of the dataset, and inlcude the code and the timestamps plus the other contextual information.
